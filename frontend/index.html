<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PMO 報告自動化系統</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap');
        
        :root {
            --primary: #4f46e5;
            --primary-dark: #4338ca;
            --primary-light: #c7d2fe;
            --secondary: #f97316;
            --secondary-light: #ffedd5;
            --success: #10b981;
            --error: #ef4444;
            --dark: #1e293b;
            --light: #f8fafc;
        }
        
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background: linear-gradient(135deg, #f0f4f8 0%, #dbeafe 100%);
            color: var(--dark);
            min-height: 100vh;
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.15);
        }
        
        .file-drop-area {
            border: 2px dashed #cbd5e1;
            border-radius: 0.75rem;
            padding: 1.5rem;
            text-align: center;
            background-color: rgba(248, 250, 252, 0.8);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .file-drop-area.drag-over {
            border-color: var(--primary);
            background-color: rgba(199, 210, 254, 0.2);
            transform: scale(1.01);
        }
        
        .file-drop-area input[type=file] {
            position: absolute;
            left: 0;
            top: 0;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }
        
        .file-list {
            max-height: 180px;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: var(--primary-light) transparent;
        }
        
        .file-list::-webkit-scrollbar {
            width: 6px;
        }
        
        .file-list::-webkit-scrollbar-track {
            background: transparent;
        }
        
        .file-list::-webkit-scrollbar-thumb {
            background-color: var(--primary-light);
            border-radius: 20px;
        }
        
        .progress-bar {
            height: 6px;
            transition: width 0.5s ease;
            position: relative;
            overflow: hidden;
        }
        
        .progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, 
                rgba(255,255,255,0) 0%, 
                rgba(255,255,255,0.5) 50%, 
                rgba(255,255,255,0) 100%);
            animation: shimmer 2s infinite;
            transform: translateX(-100%);
        }
        
        @keyframes shimmer {
            100% {
                transform: translateX(100%);
            }
        }
        
        .file-item {
            animation: slideIn 0.4s ease;
            transition: all 0.3s ease;
        }
        
        .file-item:hover {
            transform: translateX(5px);
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-15px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .btn {
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .btn::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 5px;
            height: 5px;
            background: rgba(255, 255, 255, 0.5);
            opacity: 0;
            border-radius: 100%;
            transform: scale(1, 1) translate(-50%);
            transform-origin: 50% 50%;
        }
        
        .btn:focus:not(:active)::after {
            animation: ripple 1s ease-out;
        }
        
        @keyframes ripple {
            0% {
                transform: scale(0, 0);
                opacity: 0.5;
            }
            20% {
                transform: scale(25, 25);
                opacity: 0.3;
            }
            100% {
                opacity: 0;
                transform: scale(40, 40);
            }
        }
        
        .floating {
            animation: floating 3s ease-in-out infinite;
        }
        
        @keyframes floating {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }
        
        .pulse-ring {
            position: relative;
        }
        
        .pulse-ring::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border-radius: 50%;
            box-shadow: 0 0 0 0 rgba(79, 70, 229, 0.7);
            animation: pulse-ring 2s infinite;
        }
        
        @keyframes pulse-ring {
            0% {
                transform: scale(0.8);
                box-shadow: 0 0 0 0 rgba(79, 70, 229, 0.7);
            }
            70% {
                transform: scale(1);
                box-shadow: 0 0 0 10px rgba(79, 70, 229, 0);
            }
            100% {
                transform: scale(0.8);
            }
        }
        
        .step-item {
            transition: all 0.3s ease;
        }
        
        .step-item.active {
            transform: scale(1.05);
        }
        
        .step-item.completed .step-circle {
            background-color: var(--success);
            border-color: var(--success);
        }
        
        .step-item.active .step-circle {
            box-shadow: 0 0 0 5px rgba(79, 70, 229, 0.2);
        }
        
        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: #f00;
            opacity: 0;
        }
    </style>
</head>
<body class="py-8 px-4">
    <div class="max-w-4xl mx-auto">
        <div class="glass-card rounded-2xl overflow-hidden mb-8">
            <div class="relative bg-gradient-to-r from-indigo-600 via-purple-600 to-indigo-800 p-8 text-white overflow-hidden">
                <div class="absolute top-0 left-0 w-full h-full overflow-hidden opacity-20">
                    <div class="absolute w-40 h-40 rounded-full bg-white opacity-20" 
                         style="top: -10%; left: 10%; animation: floating 8s ease-in-out infinite;"></div>
                    <div class="absolute w-20 h-20 rounded-full bg-white opacity-10" 
                         style="top: 60%; left: 15%; animation: floating 6s ease-in-out infinite 1s;"></div>
                    <div class="absolute w-32 h-32 rounded-full bg-white opacity-15" 
                         style="top: 30%; left: 85%; animation: floating 7s ease-in-out infinite 0.5s;"></div>
                </div>
                
                <div class="relative z-10 flex items-center justify-between">
                    <div>
                        <h1 class="text-3xl md:text-4xl font-bold animate__animated animate__fadeInDown">PMO 報告自動化系統</h1>
                        <p class="mt-2 text-indigo-100 animate__animated animate__fadeInUp animate__delay-1s">
                            快速整合多個 PPT 檔案，生成標準化報告
                        </p>
                    </div>
                    <div class="hidden md:block floating">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-20 w-20 text-white opacity-90" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                            <polyline points="14 2 14 8 20 8"></polyline>
                            <line x1="16" y1="13" x2="8" y2="13"></line>
                            <line x1="16" y1="17" x2="8" y2="17"></line>
                            <polyline points="10 9 9 9 8 9"></polyline>
                        </svg>
                    </div>
                </div>
            </div>
            
            <div class="p-6 md:p-8">
                <div id="main-container">
                    <div class="mb-8">
                        <div class="flex items-center justify-between">
                            <div id="step-1" class="step-item flex flex-col items-center active">
                                <div class="step-circle w-10 h-10 rounded-full bg-indigo-600 flex items-center justify-center text-white font-bold">1</div>
                                <div class="text-sm mt-2 font-medium text-indigo-600">上傳檔案</div>
                            </div>
                            
                            <div class="flex-1 h-1 mx-2 bg-gray-200">
                                <div id="progress-1-2" class="h-full bg-indigo-600 transition-all duration-500" style="width: 0%"></div>
                            </div>
                            
                            <div id="step-2" class="step-item flex flex-col items-center">
                                <div class="step-circle w-10 h-10 rounded-full bg-gray-300 flex items-center justify-center text-gray-600 font-bold">2</div>
                                <div class="text-sm mt-2 font-medium text-gray-500">處理中</div>
                            </div>
                            
                            <div class="flex-1 h-1 mx-2 bg-gray-200">
                                <div id="progress-2-3" class="h-full bg-indigo-600 transition-all duration-500" style="width: 0%"></div>
                            </div>
                            
                            <div id="step-3" class="step-item flex flex-col items-center">
                                <div class="step-circle w-10 h-10 rounded-full bg-gray-300 flex items-center justify-center text-gray-600 font-bold">3</div>
                                <div class="text-sm mt-2 font-medium text-gray-500">完成</div>
                            </div>
                        </div>
                    </div>
                    
                    <form id="uploadForm" class="space-y-6">
                        <div class="animate__animated animate__fadeInUp">
                            <label for="word_template" class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-indigo-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                </svg>
                                Word 範本 (.docx)
                            </label>
                            <div class="file-drop-area" id="word-drop-area">
                                <div class="text-center">
                                    <div class="mx-auto h-16 w-16 text-indigo-600 mb-3 floating">
                                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 13l-7 7-7-7m14-8l-7 7-7-7" />
                                        </svg>
                                    </div>
                                    <p class="text-sm text-gray-600 mb-1">拖曳檔案至此或點擊上傳</p>
                                    <p class="text-xs text-gray-500">支援 .docx 格式</p>
                                </div>
                                <input type="file" id="word_template" name="word_template" accept=".docx" required>
                            </div>
                            <div id="word-file-info" class="mt-3 hidden">
                                <div class="flex items-center p-4 bg-indigo-50 rounded-lg border border-indigo-100 animate__animated animate__fadeInUp">
                                    <div class="flex-shrink-0">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-indigo-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                        </svg>
                                    </div>
                                    <div class="ml-3 flex-1">
                                        <h3 class="text-sm font-medium text-indigo-800" id="word-filename"></h3>
                                        <div class="mt-1 text-xs text-indigo-600" id="word-filesize"></div>
                                    </div>
                                    <button type="button" id="remove-word" class="ml-auto bg-indigo-100 text-indigo-600 rounded-full p-1 hover:bg-indigo-200 transition-colors">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                                        </svg>
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="animate__animated animate__fadeInUp animate__delay-1s">
                            <label for="ppt_files" class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-orange-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" />
                                </svg>
                                PPT 檔案 (.pptx)
                            </label>
                            <div class="file-drop-area" id="ppt-drop-area">
                                <div class="text-center">
                                    <div class="mx-auto h-16 w-16 text-orange-500 mb-3 floating">
                                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" />
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 13l-7 7-7-7m14-8l-7 7-7-7" />
                                        </svg>
                                    </div>
                                    <p class="text-sm text-gray-600 mb-1">拖曳多個檔案至此或點擊上傳</p>
                                    <p class="text-xs text-gray-500">支援 .pptx 格式</p>
                                </div>
                                <input type="file" id="ppt_files" name="ppt_files" accept=".pptx" multiple required>
                            </div>
                            <div id="ppt-files-container" class="mt-3 hidden">
                                <div class="bg-orange-50 rounded-lg border border-orange-100 p-4 animate__animated animate__fadeInUp">
                                    <div class="flex items-center justify-between mb-3">
                                        <div class="flex items-center">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-orange-500 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4" />
                                            </svg>
                                            <span class="text-sm font-medium text-orange-800" id="ppt-file-count">已選擇的檔案</span>
                                        </div>
                                        <button type="button" id="remove-all-ppt" class="text-xs text-orange-600 hover:text-orange-800 flex items-center">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                            </svg>
                                            移除全部
                                        </button>
                                    </div>
                                    <ul id="ppt-files-list" class="file-list space-y-2"></ul>
                                </div>
                            </div>
                        </div>
                        
                        <div class="pt-4 animate__animated animate__fadeInUp animate__delay-2s">
                            <button type="submit" id="submit-button" class="btn w-full bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 focus:ring-4 focus:ring-indigo-300 text-white font-medium rounded-xl text-base px-5 py-4 transition duration-300 ease-in-out transform hover:-translate-y-1 flex items-center justify-center shadow-lg">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
                                </svg>
                                產生報告
                            </button>
                        </div>
                    </form>
                </div>
                
                <div id="processing-view" class="hidden">
                    <div class="space-y-8">
                        <div class="flex justify-center py-6 animate__animated animate__fadeIn">
                            <div class="relative">
                                <svg class="animate-spin h-20 w-20 text-indigo-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                </svg>
                                <div class="absolute inset-0 flex items-center justify-center">
                                    <span id="progress-percentage" class="text-indigo-800 font-bold text-lg">0%</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="space-y-4">
                            <div class="flex items-center justify-between">
                                <h3 class="text-sm font-medium text-gray-700">處理進度</h3>
                                <span id="progress-status" class="text-sm font-medium text-indigo-600">準備中...</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2.5 overflow-hidden">
                                <div id="progress-bar" class="progress-bar bg-gradient-to-r from-indigo-600 to-purple-600 h-2.5 rounded-full" style="width: 0%"></div>
                            </div>
                            
                            <div class="space-y-3 mt-6">
                                <div id="process-step-1" class="flex items-center">
                                    <div class="w-8 h-8 rounded-full border-2 border-gray-300 flex items-center justify-center mr-3">
                                        <div id="process-step-1-icon" class="w-4 h-4"></div>
                                    </div>
                                    <div class="flex-1">
                                        <div class="flex items-center justify-between">
                                            <span class="text-sm font-medium text-gray-700">讀取檔案</span>
                                            <span id="process-step-1-status" class="text-xs text-gray-500">等待中</span>
                                        </div>
                                        <div id="process-step-1-bar" class="w-full h-1 bg-gray-200 rounded-full mt-1 hidden">
                                            <div class="h-full bg-indigo-600 rounded-full" style="width: 0%"></div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div id="process-step-2" class="flex items-center opacity-50">
                                    <div class="w-8 h-8 rounded-full border-2 border-gray-300 flex items-center justify-center mr-3">
                                        <div id="process-step-2-icon" class="w-4 h-4"></div>
                                    </div>
                                    <div class="flex-1">
                                        <div class="flex items-center justify-between">
                                            <span class="text-sm font-medium text-gray-700">分析 PPT 內容</span>
                                            <span id="process-step-2-status" class="text-xs text-gray-500">等待中</span>
                                        </div>
                                        <div id="process-step-2-bar" class="w-full h-1 bg-gray-200 rounded-full mt-1 hidden">
                                            <div class="h-full bg-indigo-600 rounded-full" style="width: 0%"></div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div id="process-step-3" class="flex items-center opacity-50">
                                    <div class="w-8 h-8 rounded-full border-2 border-gray-300 flex items-center justify-center mr-3">
                                        <div id="process-step-3-icon" class="w-4 h-4"></div>
                                    </div>
                                    <div class="flex-1">
                                        <div class="flex items-center justify-between">
                                            <span class="text-sm font-medium text-gray-700">整合至 Word 範本</span>
                                            <span id="process-step-3-status" class="text-xs text-gray-500">等待中</span>
                                        </div>
                                        <div id="process-step-3-bar" class="w-full h-1 bg-gray-200 rounded-full mt-1 hidden">
                                            <div class="h-full bg-indigo-600 rounded-full" style="width: 0%"></div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div id="process-step-4" class="flex items-center opacity-50">
                                    <div class="w-8 h-8 rounded-full border-2 border-gray-300 flex items-center justify-center mr-3">
                                        <div id="process-step-4-icon" class="w-4 h-4"></div>
                                    </div>
                                    <div class="flex-1">
                                        <div class="flex items-center justify-between">
                                            <span class="text-sm font-medium text-gray-700">產生最終報告</span>
                                            <span id="process-step-4-status" class="text-xs text-gray-500">等待中</span>
                                        </div>
                                        <div id="process-step-4-bar" class="w-full h-1 bg-gray-200 rounded-full mt-1 hidden">
                                            <div class="h-full bg-indigo-600 rounded-full" style="width: 0%"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div id="status-message" class="text-sm text-center text-gray-600 mt-4">準備處理檔案...</div>
                        </div>
                        
                        <div class="flex justify-center">
                            <button id="cancel-button" class="text-indigo-600 hover:text-indigo-800 text-sm font-medium flex items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                                </svg>
                                取消處理
                            </button>
                        </div>
                    </div>
                </div>
                
                <div id="result-view" class="hidden">
                    <div class="text-center py-6">
                        <div id="success-animation" class="mb-6">
                            <div class="pulse-ring rounded-full h-24 w-24 flex items-center justify-center bg-green-100 mx-auto">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-green-600 animate__animated animate__bounceIn" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                                </svg>
                            </div>
                        </div>
                        
                        <h2 class="text-2xl font-bold text-gray-800 mb-2 animate__animated animate__fadeInUp">報告產生成功！</h2>
                        <p class="text-gray-600 mb-8 animate__animated animate__fadeInUp animate__delay-1s">您的 PMO 報告已經成功產生，可以立即下載或分享。</p>
                        
                        <div class="max-w-md mx-auto bg-white rounded-xl border border-gray-200 shadow-md p-4 mb-8 animate__animated animate__fadeInUp animate__delay-2s">
                            <div class="flex items-center">
                                <div class="bg-blue-100 rounded-lg p-3 mr-4">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                    </svg>
                                </div>
                                <div class="flex-1 min-w-0">
                                    <h3 class="text-sm font-medium text-gray-900 truncate">PMO_報告_<span id="current-date"></span>.docx</h3>
                                    <p class="text-xs text-gray-500">Word 文件 • 2.4 MB</p>
                                </div>
                                <div class="inline-flex items-center text-sm font-medium text-blue-600">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                                    </svg>
                                </div>
                            </div>
                            
                            <div class="mt-4 flex items-center justify-between text-xs text-gray-500">
                                <div>建立於 <span id="creation-time"></span></div>
                                <div>整合了 <span id="ppt-count">0</span> 個 PPT 檔案</div>
                            </div>
                        </div>
                        
                        <div class="flex flex-col sm:flex-row gap-4 justify-center animate__animated animate__fadeInUp animate__delay-3s">
                            <button id="download-button" class="btn flex-1 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white font-medium rounded-xl text-base px-5 py-4 transition duration-300 ease-in-out shadow-lg flex items-center justify-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                                </svg>
                                下載報告
                            </button>
                            
                            <button id="share-button" class="btn flex-1 bg-white border border-gray-300 hover:bg-gray-50 text-gray-700 font-medium rounded-xl text-base px-5 py-4 transition duration-300 ease-in-out shadow-sm flex items-center justify-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z" />
                                </svg>
                                分享報告
                            </button>
                        </div>
                        
                        <button id="new-report-button" class="mt-8 text-indigo-600 hover:text-indigo-800 text-sm font-medium flex items-center mx-auto">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
                            </svg>
                            建立新報告
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="share-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden animate__animated animate__fadeIn">
            <div class="bg-white rounded-2xl max-w-md w-full mx-4 animate__animated animate__zoomIn">
                <div class="p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-bold text-gray-900">分享報告</h3>
                        <button id="close-modal" class="text-gray-400 hover:text-gray-500">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                            </svg>
                        </button>
                    </div>
                    
                    <div class="mb-6">
                        <label for="share-link" class="block text-sm font-medium text-gray-700 mb-2">報告連結</label>
                        <div class="flex">
                            <input type="text" id="share-link" value="https://pmo-reports.example.com/r/a1b2c3d4" class="flex-1 rounded-l-lg border border-gray-300 px-4 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" readonly>
                            <button id="copy-link" class="bg-gray-100 border border-l-0 border-gray-300 rounded-r-lg px-4 hover:bg-gray-200">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
                                </svg>
                            </button>
                        </div>
                    </div>
                    
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-700 mb-3">分享至</label>
                        <div class="grid grid-cols-4 gap-3">
                            <button class="flex flex-col items-center justify-center p-3 rounded-lg hover:bg-gray-50 transition-colors">
                                <div class="w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center mb-2">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-blue-600" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M22 12c0-5.523-4.477-10-10-10S2 6.477 2 12c0 4.991 3.657 9.128 8.438 9.878v-6.987h-2.54V12h2.54V9.797c0-2.506 1.492-3.89 3.777-3.89 1.094 0 2.238.195 2.238.195v2.46h-1.26c-1.243 0-1.63.771-1.63 1.562V12h2.773l-.443 2.89h-2.33v6.988C18.343 21.128 22 16.991 22 12z" />
                                    </svg>
                                </div>
                                <span class="text-xs">Facebook</span>
                            </button>
                            
                            <button class="flex flex-col items-center justify-center p-3 rounded-lg hover:bg-gray-50 transition-colors">
                                <div class="w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center mb-2">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-blue-600" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M8.29 20.251c7.547 0 11.675-6.253 11.675-11.675 0-.178 0-.355-.012-.53A8.348 8.348 0 0022 5.92a8.19 8.19 0 01-2.357.646 4.118 4.118 0 001.804-2.27 8.224 8.224 0 01-2.605.996 4.107 4.107 0 00-6.993 3.743 11.65 11.65 0 01-8.457-4.287 4.106 4.106 0 001.27 5.477A4.072 4.072 0 012.8 9.713v.052a4.105 4.105 0 003.292 4.022 4.095 4.095 0 01-1.853.07 4.108 4.108 0 003.834 2.85A8.233 8.233 0 012 18.407a11.616 11.616 0 006.29 1.84" />
                                    </svg>
                                </div>
                                <span class="text-xs">Twitter</span>
                            </button>
                            
                            <button class="flex flex-col items-center justify-center p-3 rounded-lg hover:bg-gray-50 transition-colors">
                                <div class="w-10 h-10 rounded-full bg-green-100 flex items-center justify-center mb-2">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-green-600" viewBox="0 0 24 24" fill="currentColor">
                                        <path fill-rule="evenodd" d="M18.042 13.045c-.293-.146-1.736-.857-2.004-.955-.268-.097-.463-.146-.658.147-.195.293-.756.954-.927 1.15-.171.195-.342.22-.634.073-.293-.147-1.24-.456-2.36-1.456-.873-.777-1.462-1.737-1.633-2.03-.171-.293-.018-.451.129-.597.132-.132.293-.342.44-.513.146-.171.195-.293.293-.488.098-.195.049-.366-.024-.513-.074-.147-.659-1.587-.903-2.173-.239-.573-.48-.496-.66-.505-.17-.008-.366-.01-.562-.01-.195 0-.513.073-.78.366-.268.293-1.025.999-1.025 2.44 0 1.44 1.049 2.832 1.195 3.027.146.195 2.056 3.138 4.984 4.395.696.3 1.24.48 1.663.615.7.222 1.336.19 1.839.115.56-.085 1.736-.71 1.98-1.395.244-.684.244-1.269.17-1.393-.073-.124-.268-.196-.56-.342z" clip-rule="evenodd" />
                                    </svg>
                                </div>
                                <span class="text-xs">WhatsApp</span>
                            </button>
                            
                            <button class="flex flex-col items-center justify-center p-3 rounded-lg hover:bg-gray-50 transition-colors">
                                <div class="w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center mb-2">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-blue-600" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z" />
                                    </svg>
                                </div>
                                <span class="text-xs">LinkedIn</span>
                            </button>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">透過電子郵件分享</label>
                        <div class="flex">
                            <input type="email" placeholder="輸入收件者電子郵件" class="flex-1 rounded-l-lg border border-gray-300 px-4 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                            <button class="bg-indigo-600 text-white rounded-r-lg px-4 py-2 text-sm hover:bg-indigo-700 transition-colors">
                                傳送
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // DOM Elements
            const form = document.getElementById('uploadForm');
            const wordInput = document.getElementById('word_template');
            const pptInput = document.getElementById('ppt_files');
            const wordFileInfo = document.getElementById('word-file-info');
            const wordFilename = document.getElementById('word-filename');
            const wordFilesize = document.getElementById('word-filesize');
            const removeWordBtn = document.getElementById('remove-word');
            const pptFilesContainer = document.getElementById('ppt-files-container');
            const pptFilesList = document.getElementById('ppt-files-list');
            const pptFileCount = document.getElementById('ppt-file-count');
            const removeAllPptBtn = document.getElementById('remove-all-ppt');
            const submitButton = document.getElementById('submit-button');
            const cancelButton = document.getElementById('cancel-button');
            const wordDropArea = document.getElementById('word-drop-area');
            const pptDropArea = document.getElementById('ppt-drop-area');
            const mainContainer = document.getElementById('main-container');
            const processingView = document.getElementById('processing-view');
            const resultView = document.getElementById('result-view');
            const progressBar = document.getElementById('progress-bar');
            const progressPercentage = document.getElementById('progress-percentage');
            const statusMessage = document.getElementById('status-message');
            const downloadButton = document.getElementById('download-button');
            const shareButton = document.getElementById('share-button');
            const newReportButton = document.getElementById('new-report-button');
            const shareModal = document.getElementById('share-modal');
            const closeModal = document.getElementById('close-modal');
            const copyLink = document.getElementById('copy-link');
            const currentDateSpan = document.getElementById('current-date');
            const creationTimeSpan = document.getElementById('creation-time');
            const pptCountSpan = document.getElementById('ppt-count');
            
            // Step indicators
            const step1 = document.getElementById('step-1');
            const step2 = document.getElementById('step-2');
            const step3 = document.getElementById('step-3');
            const progress12 = document.getElementById('progress-1-2');
            const progress23 = document.getElementById('progress-2-3');
            
            // Process steps
            const processStep1 = document.getElementById('process-step-1');
            const processStep2 = document.getElementById('process-step-2');
            const processStep3 = document.getElementById('process-step-3');
            const processStep4 = document.getElementById('process-step-4');
            const processStep1Icon = document.getElementById('process-step-1-icon');
            const processStep2Icon = document.getElementById('process-step-2-icon');
            const processStep3Icon = document.getElementById('process-step-3-icon');
            const processStep4Icon = document.getElementById('process-step-4-icon');
            const processStep1Status = document.getElementById('process-step-1-status');
            const processStep2Status = document.getElementById('process-step-2-status');
            const processStep3Status = document.getElementById('process-step-3-status');
            const processStep4Status = document.getElementById('process-step-4-status');
            const processStep1Bar = document.getElementById('process-step-1-bar');
            const processStep2Bar = document.getElementById('process-step-2-bar');
            const processStep3Bar = document.getElementById('process-step-3-bar');
            const processStep4Bar = document.getElementById('process-step-4-bar');
            
            // Helper Functions
            function formatFileSize(bytes) {
                if (bytes === 0) return '0 Bytes';
                const k = 1024;
                const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
            }
            
            function formatDate(date) {
                const year = date.getFullYear();
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const day = String(date.getDate()).padStart(2, '0');
                return `${year}${month}${day}`;
            }
            
            function formatTime(date) {
                const hours = String(date.getHours()).padStart(2, '0');
                const minutes = String(date.getMinutes()).padStart(2, '0');
                return `${hours}:${minutes}`;
            }
            
            // Set current date for the result view
            const now = new Date();
            currentDateSpan.textContent = formatDate(now);
            creationTimeSpan.textContent = formatTime(now);
            
            // Word template file handling
            wordInput.addEventListener('change', (e) => {
                if (e.target.files.length > 0) {
                    const file = e.target.files[0];
                    wordFilename.textContent = file.name;
                    wordFilesize.textContent = formatFileSize(file.size);
                    wordFileInfo.classList.remove('hidden');
                    wordDropArea.classList.add('border-indigo-300', 'bg-indigo-50');
                } else {
                    wordFileInfo.classList.add('hidden');
                    wordDropArea.classList.remove('border-indigo-300', 'bg-indigo-50');
                }
            });
            
            removeWordBtn.addEventListener('click', () => {
                wordInput.value = '';
                wordFileInfo.classList.add('hidden');
                wordDropArea.classList.remove('border-indigo-300', 'bg-indigo-50');
            });
            
            // PPT files handling
            pptInput.addEventListener('change', (e) => {
                updatePptFilesList(e.target.files);
            });
            
            removeAllPptBtn.addEventListener('click', () => {
                pptInput.value = '';
                pptFilesContainer.classList.add('hidden');
                pptFilesList.innerHTML = '';
                pptDropArea.classList.remove('border-orange-300', 'bg-orange-50');
            });
            
            function updatePptFilesList(files) {
                if (files.length > 0) {
                    pptFilesList.innerHTML = '';
                    pptFileCount.textContent = `已選擇 ${files.length} 個檔案`;
                    pptCountSpan.textContent = files.length;
                    
                    Array.from(files).forEach((file, index) => {
                        const li = document.createElement('li');
                        li.className = 'file-item flex items-center justify-between p-3 bg-white rounded-lg border border-orange-100 hover:border-orange-300 transition-colors';
                        li.innerHTML = `
                            <div class="flex items-center flex-1 min-w-0">
                                <div class="bg-orange-100 rounded-full p-1.5 mr-3">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-orange-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                    </svg>
                                </div>
                                <div class="flex-1 min-w-0">
                                    <p class="text-sm font-medium text-gray-800 truncate">${file.name}</p>
                                    <p class="text-xs text-gray-500">${formatFileSize(file.size)}</p>
                                </div>
                            </div>
                            <button type="button" class="remove-ppt-file ml-2 text-orange-600 hover:text-orange-800" data-index="${index}">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                                </svg>
                            </button>
                        `;
                        pptFilesList.appendChild(li);
                        
                        // Add event listener to remove button
                        li.querySelector('.remove-ppt-file').addEventListener('click', function() {
                            const index = parseInt(this.getAttribute('data-index'));
                            removePptFile(index);
                        });
                    });
                    
                    pptFilesContainer.classList.remove('hidden');
                    pptDropArea.classList.add('border-orange-300', 'bg-orange-50');
                } else {
                    pptFilesContainer.classList.add('hidden');
                    pptDropArea.classList.remove('border-orange-300', 'bg-orange-50');
                }
            }
            
            function removePptFile(index) {
                const dt = new DataTransfer();
                const files = pptInput.files;
                
                for (let i = 0; i < files.length; i++) {
                    if (i !== index) {
                        dt.items.add(files[i]);
                    }
                }
                
                pptInput.files = dt.files;
                updatePptFilesList(pptInput.files);
                
                if (pptInput.files.length === 0) {
                    pptFilesContainer.classList.add('hidden');
                    pptDropArea.classList.remove('border-orange-300', 'bg-orange-50');
                }
            }
            
            // Drag and drop functionality
            [
                { area: wordDropArea, input: wordInput, accept: '.docx' },
                { area: pptDropArea, input: pptInput, accept: '.pptx' }
            ].forEach(config => {
                const { area, input, accept } = config;
                
                area.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    area.classList.add('drag-over');
                });
                
                area.addEventListener('dragleave', () => {
                    area.classList.remove('drag-over');
                });
                
                area.addEventListener('drop', (e) => {
                    e.preventDefault();
                    area.classList.remove('drag-over');
                    
                    if (e.dataTransfer.files.length > 0) {
                        const validFiles = Array.from(e.dataTransfer.files).filter(file => {
                            return file.name.toLowerCase().endsWith(accept);
                        });
                        
                        if (validFiles.length > 0) {
                            const dt = new DataTransfer();
                            
                            if (input === wordInput && validFiles.length > 0) {
                                // Only take the first file for Word template
                                dt.items.add(validFiles[0]);
                            } else {
                                // Take all valid files for PPT
                                validFiles.forEach(file => dt.items.add(file));
                            }
                            
                            input.files = dt.files;
                            
                            // Trigger change event
                            const event = new Event('change');
                            input.dispatchEvent(event);
                        }
                    }
                });
            });
            
            // Form submission and processing simulation
            form.addEventListener('submit', async (event) => {
                event.preventDefault();

                if (!wordInput.files.length || !pptInput.files.length) {
                    alert('請上傳 Word 範本與至少一個 PPT');
                    return;
                }

                // 切換畫面與階段 UI
                step1.classList.remove('active');
                step1.classList.add('completed');
                step2.classList.add('active');
                progress12.style.width = '100%';
                mainContainer.classList.add('hidden');
                processingView.classList.remove('hidden');

                // 關鍵：開始模擬處理（動畫）
                await simulateProcessingAnimation();

                // 動畫結束後，才開始送出實際的 fetch 請求
                await sendProcessingRequest();
            });


            // Function to simulate processing animation steps sequentially
            async function simulateProcessingAnimation() {
                let overallProgress = 0;
                const totalSteps = 4;
                
                function updateStepProgress(step, progress) {
                    const stepBar = document.querySelector(`#process-step-${step}-bar .bg-indigo-600`);
                    if (stepBar) {
                        stepBar.style.width = `${progress}%`;
                    }
                }
                
                function completeStep(step) {
                    const stepIcon = document.getElementById(`process-step-${step}-icon`);
                    const stepStatus = document.getElementById(`process-step-${step}-status`);
                    
                    stepIcon.innerHTML = `
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-green-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                        </svg>
                    `;
                    stepStatus.textContent = '完成';
                    stepStatus.classList.remove('text-gray-500');
                    stepStatus.classList.add('text-green-600');
                }
                
                function startNextStepUI(step) {
                    if (step <= totalSteps) {
                        const currentStepElement = document.getElementById(`process-step-${step}`);
                        currentStepElement.classList.remove('opacity-50');

                        const stepIcon = document.getElementById(`process-step-${step}-icon`);
                        const stepStatus = document.getElementById(`process-step-${step}-status`);
                        const stepBar = document.getElementById(`process-step-${step}-bar`);

                        stepIcon.innerHTML = `
                            <div class="animate-spin rounded-full h-4 w-4 border-2 border-indigo-600 border-t-transparent"></div>
                        `;
                        stepStatus.textContent = '處理中...';
                        stepBar.classList.remove('hidden');
                    }
                }

                // Simulate step progress (actual animation)
                function animateStepProgress(step, duration, message) {
                    return new Promise(resolve => {
                        statusMessage.textContent = message;
                        let stepProgress = 0;
                        const startTime = Date.now();
                        const interval = 50; // Update every 50ms

                        const animate = () => {
                            const elapsed = Date.now() - startTime;
                            stepProgress = Math.min(100, (elapsed / duration) * 100);

                            updateStepProgress(step, stepProgress);
                            
                            // Update overall progress
                            const completedSteps = step - 1;
                            const currentStepContribution = stepProgress / 100 / totalSteps;
                            overallProgress = (completedSteps / totalSteps * 100) + (currentStepContribution * 100);
                            progressBar.style.width = `${overallProgress}%`;
                            progressPercentage.textContent = `${Math.round(overallProgress)}%`;

                            if (stepProgress < 100) {
                                requestAnimationFrame(animate);
                            } else {
                                completeStep(step);
                                resolve();
                            }
                        };
                        requestAnimationFrame(animate);
                    });
                }
                
                // Execute animation steps sequentially
                startNextStepUI(1);
                await animateStepProgress(1, 2000, '正在讀取檔案...'); // 讀取檔案
                
                startNextStepUI(2);
                await animateStepProgress(2, 3000, '正在分析 PPT 內容...'); // 分析 PPT 內容
                
                startNextStepUI(3);
                await animateStepProgress(3, 2500, '正在整合至 Word 範本...'); // 整合至 Word 範本
                
                startNextStepUI(4);
                await animateStepProgress(4, 1500, '正在產生最終報告...'); // 產生最終報告

                // Animating done
                statusMessage.textContent = '動畫完成，等待後端回應...';
                progressBar.style.width = '100%';
                progressPercentage.textContent = '100%';
            }

            // Function to send the actual processing request
            async function sendProcessingRequest() {
                const formData = new FormData(form);
                try {
                    const response = await fetch("/process-files/", {
                        method: "POST",
                        body: formData,
                    });

                    if (!response.ok) throw new Error("產生報告失敗，請稍後再試");

                    const blob = await response.blob();
                    const url = window.URL.createObjectURL(blob);

                    processingView.classList.add('hidden');
                    resultView.classList.remove('hidden');
                    step2.classList.remove('active');
                    step2.classList.add('completed');
                    step3.classList.add('active', 'completed');
                    progress23.style.width = '100%';

                    const now = new Date();
                    currentDateSpan.textContent = `${now.getFullYear()}${String(now.getMonth() + 1).padStart(2, '0')}${String(now.getDate()).padStart(2, '0')}`;
                    creationTimeSpan.textContent = `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`;
                    pptCountSpan.textContent = pptInput.files.length;

                    downloadButton.addEventListener('click', () => {
                        const link = document.createElement("a");
                        link.href = url;
                        link.download = "PMO報告.docx";
                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);
                        window.URL.revokeObjectURL(url);
                    });

                    createConfetti();

                } catch (error) {
                    alert(error.message || "報告產生過程中發生錯誤");

                    // 回復狀態
                    processingView.classList.add('hidden');
                    mainContainer.classList.remove('hidden');
                    step1.classList.add('active');
                    step2.classList.remove('active', 'completed');
                    step3.classList.remove('active', 'completed');
                    progress12.style.width = '0%';
                    progress23.style.width = '0%';
                     // Reset process steps on error
                    for (let i = 1; i <= 4; i++) {
                        const stepElement = document.getElementById(`process-step-${i}`);
                        const stepIcon = document.getElementById(`process-step-${i}-icon`);
                        const stepStatus = document.getElementById(`process-step-${i}-status`);
                        const stepBar = document.getElementById(`process-step-${i}-bar`);
                        
                        if (i > 1) stepElement.classList.add('opacity-50');
                        stepIcon.innerHTML = '';
                        stepStatus.textContent = '等待中';
                        stepStatus.classList.remove('text-green-600');
                        stepStatus.classList.add('text-gray-500');
                        stepBar.classList.add('hidden');
                        const progressBarInner = stepBar.querySelector('.bg-indigo-600');
                        if (progressBarInner) progressBarInner.style.width = '0%';
                    }
                     // Reset overall progress bar
                    progressBar.style.width = '0%';
                    progressPercentage.textContent = '0%';
                    statusMessage.textContent = '準備處理檔案...';
                }
            }
            
            // Cancel processing
            cancelButton.addEventListener('click', () => {
                processingView.classList.add('hidden');
                mainContainer.classList.remove('hidden');
                
                // Reset step indicators
                step1.classList.add('active');
                step2.classList.remove('active', 'completed');
                step3.classList.remove('active', 'completed');
                progress12.style.width = '0%';
                progress23.style.width = '0%';
                
                // Reset process steps
                for (let i = 1; i <= 4; i++) {
                    const stepElement = document.getElementById(`process-step-${i}`);
                    const stepIcon = document.getElementById(`process-step-${i}-icon`);
                    const stepStatus = document.getElementById(`process-step-${i}-status`);
                    const stepBar = document.getElementById(`process-step-${i}-bar`);
                    
                    if (i > 1) stepElement.classList.add('opacity-50');
                    stepIcon.innerHTML = '';
                    stepStatus.textContent = '等待中';
                    stepStatus.classList.remove('text-green-600');
                    stepStatus.classList.add('text-gray-500');
                    stepBar.classList.add('hidden');
                    const progressBarInner = stepBar.querySelector('.bg-indigo-600');
                    if (progressBarInner) progressBarInner.style.width = '0%';
                }
                
                // Reset progress bar
                progressBar.style.width = '0%';
                progressPercentage.textContent = '0%';
                statusMessage.textContent = '準備處理檔案...';
            });
            
            // Download button
            downloadButton.addEventListener('click', () => {
                // Simulate download with animation
                downloadButton.innerHTML = `
                    <svg class="animate-spin h-5 w-5 mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    下載中...
                `;
                
                setTimeout(() => {
                    downloadButton.innerHTML = `
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                        </svg>
                        下載完成
                    `;
                    
                    setTimeout(() => {
                        downloadButton.innerHTML = `
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                            </svg>
                            下載報告
                        `;
                    }, 2000);
                }, 2000);
            });
            
            // Share button and modal
            shareButton.addEventListener('click', () => {
                shareModal.classList.remove('hidden');
            });
            
            closeModal.addEventListener('click', () => {
                shareModal.classList.add('hidden');
            });
            
            // Close modal when clicking outside
            shareModal.addEventListener('click', (e) => {
                if (e.target === shareModal) {
                    shareModal.classList.add('hidden');
                }
            });
            
            // Copy link button
            copyLink.addEventListener('click', () => {
                const shareLink = document.getElementById('share-link');
                shareLink.select();
                document.execCommand('copy');
                
                // Show copied feedback
                const originalHTML = copyLink.innerHTML;
                copyLink.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-green-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                    </svg>
                `;
                
                setTimeout(() => {
                    copyLink.innerHTML = originalHTML;
                }, 2000);
            });
            
            // New report button
            newReportButton.addEventListener('click', () => {
                // Reset form
                form.reset();
                wordFileInfo.classList.add('hidden');
                pptFilesContainer.classList.add('hidden');
                wordDropArea.classList.remove('border-indigo-300', 'bg-indigo-50');
                pptDropArea.classList.remove('border-orange-300', 'bg-orange-50');
                
                // Reset step indicators
                step1.classList.add('active');
                step1.classList.remove('completed');
                step2.classList.remove('active', 'completed');
                step3.classList.remove('active', 'completed');
                progress12.style.width = '0%';
                progress23.style.width = '0%';
                
                // Show main container
                resultView.classList.add('hidden');
                mainContainer.classList.remove('hidden');

                // Reset process steps to initial state
                for (let i = 1; i <= 4; i++) {
                    const stepElement = document.getElementById(`process-step-${i}`);
                    const stepIcon = document.getElementById(`process-step-${i}-icon`);
                    const stepStatus = document.getElementById(`process-step-${i}-status`);
                    const stepBar = document.getElementById(`process-step-${i}-bar`);
                    
                    if (i > 1) stepElement.classList.add('opacity-50');
                    stepIcon.innerHTML = '';
                    stepStatus.textContent = '等待中';
                    stepStatus.classList.remove('text-green-600');
                    stepStatus.classList.add('text-gray-500');
                    stepBar.classList.add('hidden');
                    const progressBarInner = stepBar.querySelector('.bg-indigo-600');
                    if (progressBarInner) progressBarInner.style.width = '0%';
                }
                 // Reset overall progress bar
                progressBar.style.width = '0%';
                progressPercentage.textContent = '0%';
                statusMessage.textContent = '準備處理檔案...';
            });
            
            // Confetti animation
            function createConfetti() {
                const confettiContainer = document.getElementById('success-animation');
                const colors = ['#4f46e5', '#10b981', '#f97316', '#ef4444', '#3b82f6', '#ec4899'];
                const confettiCount = 100;
                
                for (let i = 0; i < confettiCount; i++) {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.left = Math.random() * 100 + '%';
                    confetti.style.top = (Math.random() * 20 - 10) + '%';
                    confetti.style.width = Math.random() * 8 + 6 + 'px';
                    confetti.style.height = Math.random() * 4 + 4 + 'px';
                    confetti.style.opacity = Math.random() + 0.5;
                    confetti.style.transform = 'rotate(' + Math.random() * 360 + 'deg)';
                    
                    confettiContainer.appendChild(confetti);
                    
                    // Animate confetti
                    const animation = confetti.animate(
                        [
                            { transform: `translate(0, 0) rotate(0deg)`, opacity: 1 },
                            { transform: `translate(${Math.random() * 200 - 100}px, ${Math.random() * 200 + 100}px) rotate(${Math.random() * 360}deg)`, opacity: 0 }
                        ],
                        {
                            duration: Math.random() * 2000 + 1500,
                            easing: 'cubic-bezier(0, .9, .57, 1)',
                            delay: Math.random() * 1000
                        }
                    );
                    
                    animation.onfinish = () => confetti.remove();
                }
            }
        });
    </script>
</body>
</html>